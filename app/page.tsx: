import Link from "next/link";
import { prisma } from "@/lib/prisma";
import { deleteListing } from "@/app/actions";

export default async function Home() {
  const year = new Date().getFullYear();

  const listings = await prisma.listing.findMany({
    orderBy: { createdAt: "desc" },
    take: 10,
  });

  return (
    <div className="page">
      {/* NAVBAR */}
      <header className="nav">
        <div className="logo">
          <div className="logo-icon">‚óé</div>
          <div>TUBESWAP</div>
        </div>

        <nav className="nav-links">
          <a href="#angebote">Angebote</a>
          <a href="#how">So funktioniert‚Äôs</a>
          <a href="#community">Community</a>
        </nav>

        <div className="nav-actions">
          <button className="btn btn-outline">Login</button>
          <button className="btn btn-primary">Kostenlos registrieren</button>
        </div>
      </header>

      {/* MAIN GRID */}
      <main className="main-grid">
        {/* LEFT: HERO */}
        <section className="hero-card">
          <div className="hero-badge-row">
            <div className="hero-badge">
              <span className="hero-badge-dot"></span>
              LIVE TAUSCHB√ñRSE
            </div>
            <span>F√ºr R√∂hren-Nerds, Bastler & HiFi-Freaks</span>
          </div>

          <h1>
            Tausche deine <span>R√∂hren</span> statt sie im Schrank verstauben zu lassen.
          </h1>

          <p className="hero-subtitle">
            Finde passende Endr√∂hren, NOS-Sch√§tze oder komplette R√∂hrenamps ‚Äì direkt von
            anderen Enthusiasten, ohne anonyme Massenplattformen.
          </p>

          <div className="hero-actions">
            <Link className="btn btn-primary" href="/new">
              Erste Anzeige erstellen
            </Link>
            <a className="btn" href="#angebote">
              Aktuelle Angebote ansehen
            </a>
          </div>

          <div className="hero-meta">
            <div className="meta-pill">
              <span className="meta-dot"></span>
              Fokus: Austausch & Tauschgesch√§fte ‚Äì kein Online-Shop
            </div>
            <div className="meta-pill">
              <span className="meta-dot"></span>
              Speziell f√ºr R√∂hren & R√∂hrenverst√§rker
            </div>
          </div>

          <div className="hero-footer">
            <div>
              Schon <strong>echte Anzeigen</strong> ‚Äì wird live aus SQLite geladen.
            </div>
            <div className="hero-footer-right">
              <div style={{ display: "flex", gap: 3 }}>
                <div className="signal-bar"></div>
                <div className="signal-bar"></div>
                <div className="signal-bar"></div>
              </div>
              <span>Community im Aufbau</span>
            </div>
          </div>
        </section>

        {/* RIGHT: LISTINGS + FILTERS */}
        <aside className="side-stack">
          <section className="card" id="angebote">
            <div className="card-header">
              <div className="card-title">Aktuelle Angebote</div>
              <div className="card-tag">live</div>
            </div>

            {/* (Filter-Chips sind noch Demo; machen wir als n√§chsten Schritt funktionsf√§hig) */}
            <div className="mini-filters">
              <button className="chip active" type="button">
                Alle
              </button>
              <button className="chip" type="button">
                Endr√∂hren
              </button>
              <button className="chip" type="button">
                Vorstufen
              </button>
              <button className="chip" type="button">
                Gitarrenamps
              </button>
              <button className="chip" type="button">
                HiFi-Amps
              </button>
            </div>

            <div className="listing-list">
              {listings.map((l) => {
                const labelClass =
                  l.kind === "TRADE" ? "trade" : l.kind === "OFFER" ? "offer" : "search";
                const labelText =
                  l.kind === "TRADE" ? "Tausch" : l.kind === "OFFER" ? "Biete" : "Suche";

                return (
                  <article className="listing" key={l.id}>
                    <div className={`listing-label ${labelClass}`}>{labelText}</div>

                    <div className="listing-main">
                      <div className="listing-title">{l.title}</div>

                      <div className="listing-meta">
                        {l.brand && (
                          <span>
                            <span className="dot"></span> Marke: {l.brand}
                          </span>
                        )}
                        {l.details && (
                          <span>
                            <span className="dot"></span> {l.details}
                          </span>
                        )}
                        {l.emission && (
                          <span>
                            <span className="dot"></span> Emission: {l.emission}
                          </span>
                        )}
                      </div>
                    </div>

                    <div className="listing-side">
                      <div className="badge-location">
                        üìç {l.location ?? "Online / Versand"}
                        {l.zip ? ` ¬∑ PLZ ${l.zip}` : ""}
                      </div>

                      <div>
                        {l.status ? (
                          <div className="status-pill">
                            ‚óè <span>{l.status}</span>
                          </div>
                        ) : (
                          <div className="badge-condition">
                            Zustand: {l.condition ?? "‚Äî"}
                          </div>
                        )}
                      </div>

                      <form action={deleteListing}>
                        <input type="hidden" name="id" value={l.id} />
                        <button className="chip" type="submit" title="Anzeige l√∂schen">
                          L√∂schen
                        </button>
                      </form>
                    </div>
                  </article>
                );
              })}

              {listings.length === 0 && (
                <article className="listing">
                  <div className="listing-label search">Info</div>
                  <div className="listing-main">
                    <div className="listing-title">Noch keine echten Anzeigen.</div>
                    <div className="listing-meta">
                      <span>
                        <span className="dot"></span> Erstelle die erste Anzeige √ºber ‚ÄûErste Anzeige
                        erstellen‚Äú.
                      </span>
                    </div>
                  </div>
                  <div className="listing-side">
                    <div className="badge-location">üìç TubeSwap</div>
                    <div className="badge-condition">Zustand: ‚Äî</div>
                  </div>
                </article>
              )}
            </div>

            <div className="card-footer-link">
              <span>‚û° N√§chster Schritt: echte Filter & Detailseiten</span>
            </div>
          </section>

          <section className="card" id="community">
            <div className="card-header">
              <div className="card-title">Community-Signal</div>
              <div className="card-tag">Ideen</div>
            </div>
            <p style={{ fontSize: 12, color: "var(--muted)", margin: "0 0 8px" }}>
              Hier k√∂nnte sp√§ter stehen:
            </p>
            <ul
              style={{
                margin: 0,
                paddingLeft: 16,
                fontSize: 12,
                color: "var(--muted)",
                display: "grid",
                gap: 4,
              }}
            >
              <li>Letzte erfolgreiche Tauschaktionen</li>
              <li>Bewertungen von Nutzern (z.B. ‚ÄûTop Kontakt, schnelle Abwicklung‚Äú)</li>
              <li>Kleine Hinweise: R√∂hrentypen, Messwerte, Sicherheits-Tipps</li>
            </ul>
          </section>
        </aside>
      </main>

      {/* HOW IT WORKS */}
      <section className="howitworks" id="how">
        <div className="how-card">
          <h2>So funktioniert TubeSwap</h2>
          <p>
            Die Plattform ist als <strong>Tauschb√∂rse</strong> gedacht. Du kannst nat√ºrlich auch
            verkaufen oder nur suchen ‚Äì aber der Fokus liegt auf fairem Austausch unter
            Gleichgesinnten.
          </p>

          <ol className="steps">
            <li>
              <div className="step-index">1</div>
              <div>
                <strong>Profil anlegen</strong>
                <br />
                Standort angeben, Interessen ausw√§hlen (HiFi, Gitarre, DIY, Messger√§te ‚Ä¶).
              </div>
            </li>
            <li>
              <div className="step-index">2</div>
              <div>
                <strong>Anzeige erstellen</strong>
                <br />
                R√∂hrentyp, Zustand, Messwerte und deine Tauschw√ºnsche eintragen.
              </div>
            </li>
            <li>
              <div className="step-index">3</div>
              <div>
                <strong>Direkt schreiben</strong>
                <br />
                Andere Nutzer kontaktieren, Details kl√§ren, Treffpunkt oder Versand absprechen.
              </div>
            </li>
          </ol>
        </div>

        <div className="how-card">
          <h2>Was wir (sp√§ter) noch erg√§nzen k√∂nnen</h2>
          <p>
            Die Startseite basiert auf deinem Mockup. Jetzt f√ºllen wir sie Schritt f√ºr Schritt
            mit echten Funktionen.
          </p>

          <div className="pill-row">
            <div className="small-pill">üîí Benutzerkonten & Login</div>
            <div className="small-pill">‚úâ interne Nachrichten</div>
            <div className="small-pill">‚≠ê Bewertungen / Trust-Level</div>
            <div className="small-pill">üß™ Messwert-Felder f√ºr R√∂hren</div>
            <div className="small-pill">üìç Umkreissuche nach PLZ</div>
            <div className="small-pill">‚öñ Filter: Biete / Suche / Tausch</div>
          </div>
        </div>
      </section>

      {/* FOOTER */}
      <footer>
        <div>¬© {year} TubeSwap ¬∑ R√∂hren-Tauschb√∂rse</div>
        <div>
          Platzhalter f√ºr <a href="#">Impressum</a> & ¬∑ <a href="#">Datenschutz</a>
        </div>
      </footer>
    </div>
  );
}

